<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="Manager which handles results of message processing."><title>pallet_gear::manager - Rust</title><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Regular-46f98efaafac5295.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Regular-018c141bf0843ffd.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/FiraSans-Medium-8f9a781e4970d388.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Regular-562dcc5011b6de7d.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceSerif4-Bold-a2c9cd1067f8b328.ttf.woff2"><link rel="preload" as="font" type="font/woff2" crossorigin href="../../static.files/SourceCodePro-Semibold-d899c5a5c4aeb14a.ttf.woff2"><link rel="stylesheet" href="../../static.files/normalize-76eba96aa4d2e634.css"><link rel="stylesheet" href="../../static.files/rustdoc-e5308b57e507db71.css" id="mainThemeStyle"><link rel="stylesheet" id="themeStyle" href="../../static.files/light-d59023bfa12059d2.css"><link rel="stylesheet" disabled href="../../static.files/dark-1ca41bb1e10af075.css"><link rel="stylesheet" disabled href="../../static.files/ayu-18b4181a2f3fb862.css"><script src="../../static.files/storage-3891ce972e3a2bf8.js"></script><script defer src="../../static.files/main-98a684e84ae5b08b.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-13285aec31fa243e.css"></noscript><link rel="alternate icon" type="image/png" href="../../static.files/favicon-16x16-8b506e7a72182f1c.png"><link rel="alternate icon" type="image/png" href="../../static.files/favicon-32x32-422f7d1d52889060.png"><link rel="icon" type="image/svg+xml" href="../../static.files/favicon-2c020d218678b618.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><nav class="mobile-topbar"><button class="sidebar-menu-toggle">&#9776;</button><a class="logo-container" href="../../pallet_gear/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2></h2></nav><nav class="sidebar"><a class="logo-container" href="../../pallet_gear/index.html"><img class="rust-logo" src="../../static.files/rust-logo-151179464ae7ed46.svg" alt="logo"></a><h2 class="location"><a href="#">Module manager</a></h2><div class="sidebar-elems"><section><ul class="block"><li><a href="#structs">Structs</a></li><li><a href="#enums">Enums</a></li></ul></section></div></nav><main><div class="width-limiter"><nav class="sub"><form class="search-form"><span></span><input class="search-input" name="search" aria-label="Run search in the documentation" autocomplete="off" spellcheck="false" placeholder="Click or press ‘S’ to search, ‘?’ for more options…" type="search"><div id="help-button" title="help" tabindex="-1"><a href="../../help.html">?</a></div><div id="settings-menu" tabindex="-1"><a href="../../settings.html" title="settings"><img width="22" height="22" alt="Change settings" src="../../static.files/wheel-7b819b6101059cd0.svg"></a></div></form></nav><section id="main-content" class="content"><div class="main-heading"><h1>Module <a href="../index.html">pallet_gear</a>::<wbr><a class="mod" href="#">manager</a><button id="copy-path" title="Copy item path to clipboard"><img src="../../static.files/clipboard-7571035ce49a181d.svg" width="19" height="18" alt="Copy item path"></button></h1><span class="out-of-band"><a class="srclink" href="../../src/pallet_gear/manager/mod.rs.html#19-374">source</a> · <button id="toggle-all-docs" title="collapse all docs">[<span>&#x2212;</span>]</button></span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>Manager which handles results of message processing.</p>
<p>Should be mentioned, that if message contains value we have a guarantee that it will be sent further in case of successful execution,
or sent back in case execution ends up with an error. This guarantee is reached by the following conditions:</p>
<ol>
<li>
<p><strong>Reserve/unreserve model for transferring values</strong>.
Ownership over message value is moved not by simple transfer operation, which decreases <strong>free</strong> balance of sender. That is done by
reserving value before message is executed and repatriating reserved in favor of beneficiary in case of successful execution, or unreserving
in case of execution resulting in a trap. So, it gives us a guarantee that regardless of the result of message execution, there is <strong>always some
value</strong> to perform asset management, i.e move tokens further to the recipient or give back to sender. The guarantee is implemented by using
corresponding <code>pallet_balances</code> functions (<code>reserve</code>, <code>repatriate_reserved</code>, <code>unreserve</code> along with <code>transfer</code>) in <code>pallet_gear</code> extrinsics,
<a href="core_processor::common::JournalHandler::send_dispatch"><code>JournalHandler::send_dispatch</code></a> and
<a href="core_processor::common::JournalHandler::send_value"><code>JournalHandler::send_value</code></a> procedures.</p>
</li>
<li>
<p><strong>Balance sufficiency before adding message with value to the queue</strong>.
Before message is added to the queue, sender’s balance is checked for having adequate amount of assets to send desired value. For actors, who
can sign transactions, these checks are done in extrinsic calls. For programs these checks are done on core backend level during execution. In details,
when a message is executed, it has some context, which is set from the pallet level, and a part of the context data is program’s actual balance (current balance +
value sent within the executing message). So if during execution of the original message some other messages were sent, message send call is followed
by program’s balance checks. The check gives guarantee that value reservation call in
<a href="core_processor::common::JournalHandler::send_dispatch"><code>JournalHandler::send_dispatch</code></a> for program’s messages won’t fail, because there is always a
sufficient balance for the call.</p>
</li>
<li>
<p><strong>Messages’s value management considers existential deposit rule</strong>.
It means that before message with value is added to the queue, value is checked to be in the valid range - <code>{0} ∪ [existential_deposit; +inf)</code>. This is
crucial for programs. The check gives guarantee that if funds were moved to the program, the program will definitely have an account in <code>pallet_balances</code>
registry and will be able then to manage these funds. Without this check, program could receive funds, but won’t be able to use them.</p>
</li>
</ol>
<p>Due to these 3 conditions implemented in <code>pallet_gear</code>, we have a guarantee that value management calls, performed by user or program, won’t fail.</p>
</div></details><h2 id="structs" class="small-section-header"><a href="#structs">Structs</a></h2><ul class="item-table"><li><div class="item-name"><a class="struct" href="struct.CodeInfo.html" title="struct pallet_gear::manager::CodeInfo">CodeInfo</a></div></li><li><div class="item-name"><a class="struct" href="struct.ExtManager.html" title="struct pallet_gear::manager::ExtManager">ExtManager</a></div><div class="desc docblock-short">Journal handler implementation for <code>pallet_gear</code>.</div></li><li><div class="item-name"><a class="struct" href="struct.QueuePostProcessingData.html" title="struct pallet_gear::manager::QueuePostProcessingData">QueuePostProcessingData</a></div><div class="desc docblock-short">Data need for depositing event about queue processing result.</div></li></ul><h2 id="enums" class="small-section-header"><a href="#enums">Enums</a></h2><ul class="item-table"><li><div class="item-name"><a class="enum" href="enum.HandleKind.html" title="enum pallet_gear::manager::HandleKind">HandleKind</a></div></li></ul></section></div></main><div id="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="pallet_gear" data-themes="" data-resource-suffix="" data-rustdoc-version="1.69.0-nightly (f77bfb733 2023-03-01)" data-search-js="search-2cde8914278f97ed.js" data-settings-js="settings-f0c5c39777a9a2f6.js" data-settings-css="settings-0bcba95ff279c1db.css" ></div></body></html>